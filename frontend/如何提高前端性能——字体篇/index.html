<!-- build time:Tue Mar 07 2023 22:14:44 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="ななこの思い" href="http://nanakoww.com/rss.xml"><link rel="alternate" type="application/atom+xml" title="ななこの思い" href="http://nanakoww.com/atom.xml"><link rel="alternate" type="application/json" title="ななこの思い" href="http://nanakoww.com/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="Frontend"><link rel="canonical" href="http://nanakoww.com/frontend/%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E2%80%94%E2%80%94%E5%AD%97%E4%BD%93%E7%AF%87/"><title>如何提高前端性能——字体篇 - Frontend | Nanako's Thoughts = ななこの思い = 學習記錄&思考</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">如何提高前端性能——字体篇</h1><div class="meta"><span class="item" title="Created: 2023-02-02 15:49:55"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">Posted on</span> <time itemprop="dateCreated datePublished" datetime="2023-02-02T15:49:55+08:00">2023-02-02</time> </span><span class="item" title="Symbols count in article"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">Symbols count in article</span> <span>4.8k</span> <span class="text">words</span> </span><span class="item" title="Reading time"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">Reading time</span> <span>4 mins.</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="Toggle navigation bar"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Nanako's Thoughts</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><img src="https://f004.backblazeb2.com/file/Nanako-blog/1_sIPcTZIrUqugaegGtmeqTg.png"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">Home</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/frontend/" itemprop="item" rel="index" title="In Frontend"><span itemprop="name">Frontend</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="en"><link itemprop="mainEntityOfPage" href="http://nanakoww.com/frontend/%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E2%80%94%E2%80%94%E5%AD%97%E4%BD%93%E7%AF%87/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Nanako"><meta itemprop="description" content="學習記錄&思考, "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="ななこの思い"></span><div class="body md" itemprop="articleBody"><h1 id="前言"><a class="anchor" href="#前言">#</a> 前言</h1><p>有时候前端开发需要使用到一些特殊字体，但宿主机上一般都没有安装相应的字体，所以需要将字体文件与前端代码一起打包以及用 CSS 定义使用。本文主要是想回答一个问题：在性能方面，我们可以怎么去优化前端需要加载的字体？</p><p>一般优化的思路主要是两方面：</p><ol><li>缩小字体文件</li><li>优化字体加载的方式</li></ol><h1 id="缩小字体文件"><a class="anchor" href="#缩小字体文件">#</a> 缩小字体文件</h1><p>字体文件一般都比较大，动不动就几兆、十几兆的，所以我们优化的第一步是想办法缩减字体文件的大小。</p><h2 id="使用特定的字体格式woffwoff2"><a class="anchor" href="#使用特定的字体格式woffwoff2">#</a> 使用特定的字体格式 ——WOFF/WOFF2</h2><p>常见的字体格式有 TTF（TrueType Font）、OTF（OpenType Font）、EOT（Embedded Open Type）、WOFF（Web Open Font Format）和 WOFF2。</p><blockquote><p>更详细的介绍字体的文章可以看：<span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8yODE3OTIwMw==">Web 字体简介: TTF, OTF, WOFF, EOT &amp; SVG</span></p></blockquote><p>简单来说，TTF 和 OTF 都是没有压缩，所以这两个格式的字体文件会更大；EOT 字体格式只有 IE 浏览器支持；SVG 对文本的支持不够好… 等等，因此<strong>使用 WOFF 可以说是前端开发的最佳选择</strong>了。（还有专家建议只用 WOFF2 字体，原文如下）</p><blockquote><p>In fact, we think it is also time to proclaim: Use only WOFF2 and forget about everything else.<br>This will simplify your CSS and workflow massively and also prevents any accidental double or incorrect font downloads. WOFF2 is now supported everywhere. So, unless you need to support really ancient browsers, just use WOFF2. If you can't, consider not serving any web fonts to those older browsers at all. This will not be a problem if you have a robust fallback strategy in place. Visitors on older browsers will simply see your fallback fonts.</p><p><span class="exturl" data-url="aHR0cHM6Ly9hbG1hbmFjLmh0dHBhcmNoaXZlLm9yZy9lbi8yMDIyL2ZvbnRzI3BlcmZvcm1hbmNl">Bram Stein, from the 2022 Web Almanac</span></p></blockquote><p>WOFF 的优点主要有两个：</p><ol><li>字体经过压缩，文件大小一般比 TTF 小 40%；</li><li>主流的浏览器新版本都支持此格式；</li></ol><blockquote><p>WOFF2 是 WOFF 的升级版，压缩率在此基础上提高了 30%。</p></blockquote><h2 id="按需压缩字体"><a class="anchor" href="#按需压缩字体">#</a> 按需压缩字体</h2><p>有时候前端页面中需要使用特殊字体的文本是固定的，那么就可以利用 <code>font-spider</code> (同类开源库还有 <code>fontmin</code> 等) 去将文本所对应的字体子集提取出来，生成一个新的子集包代替原本的全量字体包，这样即可大大减小字体文件，提高性能。</p><h3 id="使用方式"><a class="anchor" href="#使用方式">#</a> 使用方式</h3><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2F1aS9mb250LXNwaWRlcg==">官方指南</span></p><p>font-spider 可以自动分析出页面中使用过的字体并进行按需压缩，也就是说，如果页面中的文本有改动就需要重新压缩。这种压缩方式比较<strong>适合页面的文字一般不会改动的场景</strong>。</p><p>下面是我对某个字体文件的提取对比，在这个情境中我的网站只有数字部分用到了这个字体，所以没必要把整个字体文件都打包进去，所以我使用了 font-spider 把字体文件中的数字部分提取出来了。</p><p><img data-src="https://res.craft.do/user/full/a1388a82-3d1e-59f9-6dfb-26cfc7539142/doc/D3BB5B46-6795-4B27-AEA3-23501E679264/75ADDFB3-F7FD-4023-A46B-8482F3D09D0F_2/qJNxhVa0zNuxR5CzVOcornxtwMZNxlsD7MjHhnTer5kz/Image.png" alt="Image.png"></p><p><img data-src="https://res.craft.do/user/full/a1388a82-3d1e-59f9-6dfb-26cfc7539142/doc/D3BB5B46-6795-4B27-AEA3-23501E679264/B571B409-836A-4657-B8D8-3F543D468EEE_2/3ArqPjCHzynPj9wVIAbf0tjVTgHJktY38vA6qHgvIB0z/Image.png" alt="Image.png"></p><p>字体压缩前后的效果对比：</p><p><img data-src="https://res.craft.do/user/full/a1388a82-3d1e-59f9-6dfb-26cfc7539142/doc/D3BB5B46-6795-4B27-AEA3-23501E679264/EFA38A2E-D819-4D70-8C97-188B75C8ABDA_2/XWoWRP2nacKL4syb323JnkFjsKItMvWTkRib3J1MU0sz/Image.png" alt="Image.png"></p><p><img data-src="https://res.craft.do/user/full/a1388a82-3d1e-59f9-6dfb-26cfc7539142/doc/D3BB5B46-6795-4B27-AEA3-23501E679264/CDF8F253-0D38-44B6-9431-932EDC184306_2/eFFM26luiVLH2zDfVcOn08skHw0PrkjELCraE3VVckoz/Image.png" alt="Image.png"></p><h1 id="优化字体加载的方式"><a class="anchor" href="#优化字体加载的方式">#</a> 优化字体加载的方式</h1><p>下图展示了浏览器绘制页面的过程：</p><p><img data-src="https://f004.backblazeb2.com/file/Nanako-blog/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_584a4530-0d01-4768-bada-77c59d0492ef.png" alt="Image.png"></p><p>从图片我们可以看出，浏览器从请求 html 文档到呈现文本，中间还有好几个步骤。因此字体的请求会比其他关键资源请求之后延迟很长时间，并且，在获取到字体资源前，浏览器处理文本的方式也各不相同。</p><p>在加载网页上的字体时，浏览器一般会有两种选择：</p><ol><li>推迟渲染字体的时间直到字体资源下载完成（导致 FOIT）。</li><li>在下载好字体资源前用备用字体展示该内容（导致 FOUT）。</li></ol><h2 id="减少浏览器请求的次数"><a class="anchor" href="#减少浏览器请求的次数">#</a> 减少浏览器请求的次数</h2><p>虽然在使用非默认系统字体时，用户一般不会在本地安装相应的文件，但是开发者仍然需要考虑到这种情况。在定义 <code>font-face</code> 时，可以使用 <code>local()</code> 先请求本地字体，示例代码如下：</p><figure class="highlight css"><figcaption data-lang="CSS"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token atrule"><span class="token rule">@font-face</span></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">'Awesome Font'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token property">font-style</span><span class="token punctuation">:</span> normal<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token property">font-weight</span><span class="token punctuation">:</span> 400<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token property">src</span><span class="token punctuation">:</span> <span class="token function">local</span><span class="token punctuation">(</span><span class="token string">'Awesome Font'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">'/fonts/awesome.woff2'</span><span class="token punctuation">)</span></span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'woff2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">'/fonts/awesome.woff'</span><span class="token punctuation">)</span></span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'woff'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">'/fonts/awesome.ttf'</span><span class="token punctuation">)</span></span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'truetype'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">'/fonts/awesome.eot'</span><span class="token punctuation">)</span></span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'embedded-opentype'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>对于这段代码，浏览器会按照下述顺序去请求资源：</p><ol><li>浏览器渲染页面的 DOM 树，判断出需要加载哪个字体。</li><li>循环判断每个需要的字体是否可以本地使用。</li><li>如果本地没有该字体，就按照代码顺序去请求 <code>url()</code> 中定义的字体资源。<ol><li>如果有定义 <code>format</code> ，那么浏览器在下载字体资源前会先检查自己支不支持该格式，如果不支持，则继续请求下一行代码定义的字体资源。</li><li>如果没有定义 <code>format</code> ，则直接下载该资源。</li></ol></li></ol><h2 id="使用-font-display"><a class="anchor" href="#使用-font-display">#</a> 使用 font-display</h2><p>虽然不同的浏览器会对字体加载有不同的处理方式，但是开发者可以用 <code>font-display</code> 去控制这个行为。</p><blockquote><p><code>font-display</code> 在 CSS 层面上提供了此类问题的解决方法，它提供了五个属性：</p><ul><li>auto：使用浏览器默认的行为；</li><li>block：浏览器首先使用隐形文字替代页面上的文字，并等待字体加载完成再显示；</li><li>swap：如果设定的字体还未可用，浏览器将首先使用备用字体显示，当设定的字体加载完成后替换备用字体；</li><li>fallback：与 <code>swap</code> 属性值行为上大致相同，但浏览器会给设定的字体设定加载的时间限制，一旦加载所需的时长大于这个限制，设定的字体将不会替换备用字体进行显示。 Webkit 和 Firefox 中设定此时间为 3s；</li><li>optional：使用此属性值时，如果设定的字体没有在限制时间内加载完成，当前页面将会一直使用备用字体，并且设定字体继续在后台进行加载，以便下一次浏览时可以直接使用设定的字体。</li></ul><p><span class="exturl" data-url="aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC82ODQ0OTAzNjY1ODc1MDI1OTI4">NimitzDEV,《页面字体闪一下？这两个标准能帮到你》</span></p></blockquote><p>采用什么样的加载策略取决于字体的重要性、个人审美以及性能考虑等等，因此在此不做推荐，以下是几种主要策略：</p><table><thead><tr><th></th><th>性能优先</th><th>速度优先</th><th>网络字体优先</th></tr></thead><tbody><tr><td>推荐值</td><td>optional</td><td>swap</td><td>block</td></tr><tr><td>优点</td><td>非常高效，文本呈现时间短。</td><td>可以保证在使用网络字体的前提下尽早完成字体的渲染。</td><td>可以最大程度确保优先使用网络字体；尽管也会出现布局偏移，但是显示效果比 swap 的效果更平滑。</td></tr><tr><td>缺点</td><td>如果浏览器在限制时间内没有下载完字体，则不会加载网络字体。</td><td>如果字体请求过久，会导致页面出现 FOUT 闪烁。</td><td>这个策略推迟了文本的显示时间，导致 FOIT 闪烁。</td></tr></tbody></table><p>综上所述，开发者可以根据实际情况选择不同的策略，例如 <code>font-display: swap</code> 用于品牌和其他视觉上与众不同的页面元素； <code>font-display: optional</code> 用于正文中使用的字体。</p><h2 id="自定义加载方式"><a class="anchor" href="#自定义加载方式">#</a> 自定义加载方式</h2><p>如果开发者希望自定义字体加载的方式，并且愿意承担额外的 js 开销，那么还有以下选择：</p><ol><li><p>利用 <span class="exturl" data-url="aHR0cHM6Ly93d3cudzMub3JnL1RSL2Nzcy1mb250LWxvYWRpbmcv">字体加载 API</span> 去定义或者操作字体的加载行为（但是在旧浏览器中不可用）</p><blockquote><p>例如，如果您确定需要特定的字体变体，您可以定义它并告诉浏览器立即启动字体资源的获取：</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">var</span> font <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FontFace</span><span class="token punctuation">(</span><span class="token string">"Awesome Font"</span><span class="token punctuation">,</span> <span class="token string">"url(/fonts/awesome.woff2)"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token string">'normal'</span><span class="token punctuation">,</span> <span class="token literal-property property">unicodeRange</span><span class="token operator">:</span> <span class="token string">'U+000-5FF'</span><span class="token punctuation">,</span> <span class="token literal-property property">weight</span><span class="token operator">:</span> <span class="token string">'400'</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// don't wait for the render tree, initiate an immediate fetch!</span></pre></td></tr><tr><td data-num="6"></td><td><pre>font<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token comment">// apply the font (which may re-render text and cause a page reflow)</span></pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token comment">// after the font has finished downloading</span></pre></td></tr><tr><td data-num="9"></td><td><pre> document<span class="token punctuation">.</span>fonts<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>font<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>fontFamily <span class="token operator">=</span> <span class="token string">"Awesome Font, serif"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token comment">// OR... by default the content is hidden,</span></pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token comment">// and it's rendered after the font is available</span></pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token keyword">var</span> content <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"content"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre> content<span class="token punctuation">.</span>style<span class="token punctuation">.</span>visibility <span class="token operator">=</span> <span class="token string">"visible"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre> <span class="token comment">// OR... apply your own render strategy here...</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>此外，因为您可以检查字体状态（通过<a target="_blank" rel="noopener" href="https://www.w3.org/TR/css-font-loading/#font-face-set-check"> <code>check()</code> </a>）方法并跟踪其下载进度。</p><p><span class="exturl" data-url="aHR0cHM6Ly93ZWIuZGV2L29wdGltaXplLXdlYmZvbnQtbG9hZGluZy8=">Ilya Grigorik, 《优化 WebFont 加载和呈现》</span></p></blockquote></li><li><p>使用 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3R5cGVraXQvd2ViZm9udGxvYWRlcg==">Web Font Loader</span><br>只要在脚本中添加下列代码，即可使用它所提供的加载功能：</p><figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>  WebFont<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token literal-property property">google</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>      <span class="token literal-property property">families</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'Droid Sans'</span><span class="token punctuation">,</span> <span class="token string">'Droid Serif'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>它同时支持同步加载和异步加载，自由度较高。</p></li><li><p>其他方式<br>由于自定义的可能性实在是太多了，业内也有好几个开源库，因此在这里不穷举所有的实现方式。有兴趣的朋友可以阅读<span class="exturl" data-url="aHR0cHM6Ly93d3cuemFjaGxlYXQuY29tL3dlYi9jb21wcmVoZW5zaXZlLXdlYmZvbnRzLyNmb3V0LWNsYXNz"> A COMPREHENSIVE GUIDE TO FONT LOADING STRATEGIES</span>，<span class="exturl" data-url="aHR0cHM6Ly93d3cuZmlsYW1lbnRncm91cC5jb20vbGFiL2ZvbnQtZXZlbnRzLmh0bWw=">How We Load Web Fonts Progressively</span> 以及<span class="exturl" data-url="aHR0cHM6Ly8yODI3MTQubWVkaXVtLmNvbS8lRTclQjYlQjIlRTklQTAlODElRTUlOEElQTAlRTglQkMlODklRTUlQUQlOTclRTUlOUUlOEJmb2l0LWZvdXQlRTglODglODclRTYlOTUlODglRTglODMlQkQlRTYlQjglQUMlRTglQTklQTYtY2IwYjAzZGFhZDYw">網頁加載字型 Web Font FOIT&amp; FOUT 與效能測試</span>等文章。</p></li></ol><h2 id="预加载字体资源"><a class="anchor" href="#预加载字体资源">#</a> 预加载字体资源</h2><p>上文提到了如何控制浏览器处理暂不可用的字体，除此之外，开发者还可以通过 <code>preconnect</code> 和 <code>preload</code> 加快字体资源加载的速度。</p><h3 id="preconnect"><a class="anchor" href="#preconnect">#</a> preconnect</h3><p>如果开发者选择在第三方站点上托管字体，那么可以用 <code>preconnect</code> 预先与第三方来源建立连接，示例：</p><figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preconnect<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://fonts.com<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preconnect<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://fonts.com<span class="token punctuation">"</span></span> <span class="token attr-name">crossorigin</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><h3 id="preload"><a class="anchor" href="#preload">#</a> preload</h3><p>使用 <code>preload</code> 可以让浏览器优先下载字体资源，从而加快网页显示文本的速度，示例：</p><figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token comment">&lt;!-- ... --></span></pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preload<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/assets/Pacifico-Bold.woff2<span class="token punctuation">"</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>font<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>font/woff2<span class="token punctuation">"</span></span> <span class="token attr-name">crossorigin</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>但是如果使用不当，预加载可能会对未使用的资源发出不必要的请求，从而导致性能损耗。</p><h1 id="总结"><a class="anchor" href="#总结">#</a> 总结</h1><p>最简单直接的优化方式就是只用系统字体（System Font）或者可变字体（Variable Font）来减少甚至清零所需要请求的网络字体的数量；如果不得不使用网络字体，可以试试上述方式去优化网页性能。这些优化手段可以互相组合去使用，取得 1+1&gt;2 的效果。</p><p>本文只是一个粗略的介绍，对于细节问题没有过多涉及，欢迎在评论区补充更多信息。</p><h1 id="参考资料"><a class="anchor" href="#参考资料">#</a> 参考资料</h1><p><span class="exturl" data-url="aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC82OTg0OTcxOTA1MDY5NDgyMDIx">前端网页字体优化指南</span></p><p><span class="exturl" data-url="aHR0cHM6Ly93ZWIuZGV2L2NvZGVsYWItcHJlbG9hZC13ZWItZm9udHMv">通过预加载 web 字体提高加载速度</span></p><p><span class="exturl" data-url="aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC82ODQ0OTAzNjY1ODc1MDI1OTI4">页面字体闪一下？这两个标准能帮到你</span></p><p><span class="exturl" data-url="aHR0cHM6Ly93ZWIuZGV2L2Zhc3QvIw==">快速加载</span></p><p><span class="exturl" data-url="aHR0cHM6Ly8yODI3MTQubWVkaXVtLmNvbS8lRTclQjYlQjIlRTklQTAlODElRTUlOEElQTAlRTglQkMlODklRTUlQUQlOTclRTUlOUUlOEJmb2l0LWZvdXQlRTglODglODclRTYlOTUlODglRTglODMlQkQlRTYlQjglQUMlRTglQTklQTYtY2IwYjAzZGFhZDYw">網頁加載字型 Web Font FOIT&amp; FOUT 與效能測試</span></p><div class="tags"><a href="/tags/Frontend/" rel="tag"><i class="ic i-tag"></i> Frontend</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">Edited on</span> <time title="Modified: 2023-02-02 18:32:20" itemprop="dateModified" datetime="2023-02-02T18:32:20+08:00">2023-02-02</time> </span><span id="frontend/如何提高前端性能——字体篇/" class="item leancloud_visitors" data-flag-title="如何提高前端性能——字体篇" title="Views"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">Views</span> <span class="leancloud-visitors-count"></span> <span class="text">times</span></span></div><div id="copyright"><ul><li class="author"><strong>Post author: </strong>Nanako <i class="ic i-at"><em>@</em></i>ななこの思い</li><li class="link"><strong>Post link: </strong><a href="http://nanakoww.com/frontend/%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E2%80%94%E2%80%94%E5%AD%97%E4%BD%93%E7%AF%87/" title="如何提高前端性能——字体篇">http://nanakoww.com/frontend/如何提高前端性能——字体篇/</a></li><li class="license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/frontend/%E5%85%A8%E7%BD%91%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E5%A4%A7%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E4%B8%8E%E4%B8%8B%E8%BD%BD%E5%AE%9E%E7%8E%B0%EF%BC%88React+Go%EF%BC%89/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;f004.backblazeb2.com&#x2F;file&#x2F;Nanako-blog&#x2F;Cloud_upload_and_download_Icons_generated.jpg" title="全网最简单的大文件上传与下载实现（React+Go）"><span class="type">Previous Post</span> <span class="category"><i class="ic i-flag"></i> Frontend</span><h3>全网最简单的大文件上传与下载实现（React+Go）</h3></a></div><div class="item right"></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="Contents"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BC%A9%E5%B0%8F%E5%AD%97%E4%BD%93%E6%96%87%E4%BB%B6"><span class="toc-number">2.</span> <span class="toc-text">缩小字体文件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%89%B9%E5%AE%9A%E7%9A%84%E5%AD%97%E4%BD%93%E6%A0%BC%E5%BC%8Fwoffwoff2"><span class="toc-number">2.1.</span> <span class="toc-text">使用特定的字体格式 ——WOFF&#x2F;WOFF2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%89%E9%9C%80%E5%8E%8B%E7%BC%A9%E5%AD%97%E4%BD%93"><span class="toc-number">2.2.</span> <span class="toc-text">按需压缩字体</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">2.2.1.</span> <span class="toc-text">使用方式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E5%AD%97%E4%BD%93%E5%8A%A0%E8%BD%BD%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">3.</span> <span class="toc-text">优化字体加载的方式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%8F%E5%B0%91%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AF%B7%E6%B1%82%E7%9A%84%E6%AC%A1%E6%95%B0"><span class="toc-number">3.1.</span> <span class="toc-text">减少浏览器请求的次数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-font-display"><span class="toc-number">3.2.</span> <span class="toc-text">使用 font-display</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F"><span class="toc-number">3.3.</span> <span class="toc-text">自定义加载方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%84%E5%8A%A0%E8%BD%BD%E5%AD%97%E4%BD%93%E8%B5%84%E6%BA%90"><span class="toc-number">3.4.</span> <span class="toc-text">预加载字体资源</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#preconnect"><span class="toc-number">3.4.1.</span> <span class="toc-text">preconnect</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#preload"><span class="toc-number">3.4.2.</span> <span class="toc-text">preload</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">4.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">5.</span> <span class="toc-text">参考资料</span></a></li></ol></div><div class="related panel pjax" data-title="Related"><ul><li><a href="/frontend/%E5%85%A8%E7%BD%91%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E5%A4%A7%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E4%B8%8E%E4%B8%8B%E8%BD%BD%E5%AE%9E%E7%8E%B0%EF%BC%88React+Go%EF%BC%89/" rel="bookmark" title="全网最简单的大文件上传与下载实现（React+Go）">全网最简单的大文件上传与下载实现（React+Go）</a></li><li class="active"><a href="/frontend/%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E2%80%94%E2%80%94%E5%AD%97%E4%BD%93%E7%AF%87/" rel="bookmark" title="如何提高前端性能——字体篇">如何提高前端性能——字体篇</a></li></ul></div><div class="overview panel" data-title="Overview"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Nanako" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Nanako</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">3</span> <span class="name">posts</span></a></div><div class="item categories"><a href="/categories/"><span class="count">2</span> <span class="name">categories</span></a></div><div class="item tags"><a href="/tags/"><span class="count">2</span> <span class="name">tags</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL25hbmFrb3d3" title="https:&#x2F;&#x2F;github.com&#x2F;nanakoww"><i class="ic i-github"></i></span> <span class="exturl item email" data-url="bWFpbHRvOmh5eGlhb21vQGdtYWlsLmNvbQ==" title="mailto:hyxiaomo@gmail.com"><i class="ic i-envelope"></i></span> <span class="exturl item stackoverflow" data-url="aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS91c2Vycy8xMTQ4MDY5OS9uYW5ha28=" title="https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;11480699&#x2F;nanako"><i class="ic i-stack-overflow"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>Home</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>About</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>Posts</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>Archives</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>Categories</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>Tags</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"></div><div class="status"><div class="copyright">&copy; <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Nanako @ Nanako's Thoughts</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="Symbols count total">16k words</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="Reading time total">15 mins.</span></div><div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"frontend/如何提高前端性能——字体篇/",favicon:{show:"（●´3｀●）Goooood",hide:"(´Д｀)Booooom"},search:{placeholder:"Search for Posts",empty:"We didn't find any results for the search: ${query}",stats:"${hits} results found in ${time} ms"},valine:!0,fancybox:!0,copyright:'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->